import{S as Ls,i as zs,s as Gs,U as hs,y as Us,z as Rs,A as Zs,V as Vs,W as $s,g as Ns,d as js,B as Bs,X as Hs,k as F,q as n,a as f,_ as xs,l as r,m as c,r as t,h as e,c as h,$ as Ss,n as M,b as i,D as a,E as Ks}from"../chunks/index.377af8f0.js";import{P as Ms}from"../chunks/post_layout.22ed8a9d.js";function Xs(g){let o,D,u,v,l,y,m,X,J,O,Q,Y,U,_,b,ss,R,C,es,Z,d,as,$,ls,os,H,ns,ts,V,x,qs=`<pre class="shiki material-default" style="background-color: #263238; color: #EEFFFF" php="true"><div class="language-id">php</div><div class='code-container'><code><div class='line'><span style="color: #89DDFF">...</span></div><div class='line'><span style="color: #89DDFF">if</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">($</span><span style="color: #EEFFFF">tier </span><span style="color: #89DDFF">===</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">NULL)</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">&#123;</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #89DDFF">return</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Invalid credentials</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">;</span></div><div class='line'><span style="color: #89DDFF">&#125;</span></div><div class='line'></div><div class='line'><span style="color: #89DDFF">$</span><span style="color: #EEFFFF">response </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Login successful. Welcome </span><span style="color: #89DDFF">"</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">htmlspecialchars</span><span style="color: #89DDFF">($</span><span style="color: #EEFFFF">username</span><span style="color: #89DDFF">)</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">.</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">;</span></div><div class='line'></div><div class='line'><span style="color: #546E7A">// Look at this part. </span></div><div class='line'><span style="color: #89DDFF">if</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">($</span><span style="color: #EEFFFF">tier </span><span style="color: #89DDFF">===</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">gold</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">)</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">&#123;</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #89DDFF">$</span><span style="color: #EEFFFF">response </span><span style="color: #89DDFF">.=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D"> </span><span style="color: #89DDFF">"</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">getenv</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">FLAG</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #89DDFF">&#125;</span></div><div class='line'></div><div class='line'><span style="color: #89DDFF">return</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">$</span><span style="color: #EEFFFF">response</span><span style="color: #89DDFF">;</span></div><div class='line'></div><div class='line'><span style="color: #89DDFF">...</span></div></code></div></pre>`,S,A,ps,W,Fs,rs,N,w,cs,q,is,Ds,j,I,Is=`<pre class="shiki material-default" style="background-color: #263238; color: #EEFFFF" python="true"><div class="language-id">python</div><div class='code-container'><code><div class='line'><span style="color: #EEFFFF">...</span></div><div class='line'><span style="color: #89DDFF">@</span><span style="color: #82AAFF">authorized</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">route</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">/signup</span><span style="color: #89DDFF">'</span><span style="color: #89DDFF">,</span><span style="color: #82AAFF"> </span><span style="color: #EEFFFF">methods</span><span style="color: #89DDFF">=[</span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">POST</span><span style="color: #89DDFF">'</span><span style="color: #89DDFF">])</span></div><div class='line'><span style="color: #C792EA">def</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">signup_post</span><span style="color: #89DDFF">():</span></div><div class='line'><span style="color: #EEFFFF">  ...</span></div><div class='line'><span style="color: #EEFFFF">  tier </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> models</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">Tier</span><span style="color: #89DDFF">(</span><span style="color: #82AAFF">request</span><span style="color: #89DDFF">.</span><span style="color: #F07178">form</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">tier</span><span style="color: #89DDFF">'</span><span style="color: #89DDFF">))</span></div><div class='line'></div><div class='line'><span style="color: #EEFFFF">  </span><span style="color: #89DDFF">if</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">tier </span><span style="color: #89DDFF">==</span><span style="color: #EEFFFF"> models</span><span style="color: #89DDFF">.</span><span style="color: #F07178">Tier</span><span style="color: #89DDFF">.</span><span style="color: #F07178">GOLD</span><span style="color: #89DDFF">):</span></div><div class='line'><span style="color: #EEFFFF">      </span><span style="color: #82AAFF">flash</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">GOLD tier only allowed for the CEO</span><span style="color: #89DDFF">'</span><span style="color: #89DDFF">)</span></div><div class='line'><span style="color: #EEFFFF">      </span><span style="color: #89DDFF">return</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">redirect</span><span style="color: #89DDFF">(</span><span style="color: #82AAFF">url_for</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">authorized.signup</span><span style="color: #89DDFF">'</span><span style="color: #89DDFF">))</span><span style="color: #EEFFFF">  </span><span style="color: #546E7A"># Validation is based on first parameter</span></div><div class='line'><span style="color: #EEFFFF">  ...</span></div><div class='line'></div><div class='line'><span style="color: #EEFFFF">  new_user </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> models</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">User</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">username</span><span style="color: #89DDFF">=</span><span style="color: #82AAFF">username</span><span style="color: #89DDFF">,</span><span style="color: #82AAFF"> </span></div><div class='line'><span style="color: #82AAFF">  </span><span style="color: #EEFFFF">password</span><span style="color: #89DDFF">=</span><span style="color: #82AAFF">generate_password_hash</span><span style="color: #89DDFF">(</span><span style="color: #82AAFF">password</span><span style="color: #89DDFF">,</span><span style="color: #82AAFF"> </span><span style="color: #EEFFFF">method</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">sha256</span><span style="color: #89DDFF">'</span><span style="color: #89DDFF">),</span><span style="color: #82AAFF"> </span><span style="color: #EEFFFF">tier</span><span style="color: #89DDFF">=</span><span style="color: #82AAFF">tier</span><span style="color: #89DDFF">.</span><span style="color: #F07178">name</span><span style="color: #89DDFF">)</span></div><div class='line'><span style="color: #EEFFFF">  </span></div><div class='line'><span style="color: #EEFFFF">  db</span><span style="color: #89DDFF">.</span><span style="color: #F07178">session</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #82AAFF">new_user</span><span style="color: #89DDFF">)</span></div><div class='line'><span style="color: #EEFFFF">  db</span><span style="color: #89DDFF">.</span><span style="color: #F07178">session</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">commit</span><span style="color: #89DDFF">()</span></div><div class='line'><span style="color: #EEFFFF">  </span></div><div class='line'><span style="color: #EEFFFF">  requests</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">post</span><span style="color: #89DDFF">(</span><span style="color: #C792EA">f</span><span style="color: #C3E88D">"http://</span><span style="color: #82AAFF">&#123;PHP_HOST&#125;</span><span style="color: #C3E88D">:1337/account_migrator.php"</span><span style="color: #89DDFF">,</span><span style="color: #82AAFF"> </span></div><div class='line'><span style="color: #82AAFF">      </span><span style="color: #EEFFFF">headers</span><span style="color: #89DDFF">=&#123;</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">token</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">:</span><span style="color: #82AAFF"> TOKEN</span><span style="color: #89DDFF">,</span><span style="color: #82AAFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">content-type</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">:</span><span style="color: #82AAFF"> request</span><span style="color: #89DDFF">.</span><span style="color: #F07178">headers</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">content-type</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">)&#125;,</span><span style="color: #82AAFF"> </span><span style="color: #EEFFFF">data</span><span style="color: #89DDFF">=</span><span style="color: #82AAFF">raw_request</span><span style="color: #89DDFF">)</span><span style="color: #EEFFFF"> </span><span style="color: #546E7A"># Vulnerable PART</span></div><div class='line'><span style="color: #EEFFFF">  </span><span style="color: #89DDFF">return</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">redirect</span><span style="color: #89DDFF">(</span><span style="color: #82AAFF">url_for</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">authorized.login</span><span style="color: #89DDFF">'</span><span style="color: #89DDFF">))</span></div></code></div></pre>`,L,E,ys,z,ds,Es,G,us,fs;return{c(){o=F("h1"),D=F("a"),u=n("Introduction"),v=f(),l=F("p"),y=n("This writeup is for the under construction challenge from web category in Google CTF 2023. The challenge was provided with the following statement: "),m=F("em"),X=n("“We were building a web app but the new CEO wants it remade in php.”"),J=n(" The challenge contained 2 different web apps. One was in PHP that seems to be under development whilst flask app seemed like a full application. This writeup covers an "),O=F("code"),Q=n("Parameter Pollution"),Y=n(" vulnerability we were able to create an escalated user by supplying more than 1 parameter."),U=f(),_=F("h1"),b=F("a"),ss=n("Writeup"),R=f(),C=F("p"),es=n("So, at first i visited the URLS and got to know the application surface. Then i downloaded the challenge files available and opened them in the editor."),Z=f(),d=F("p"),as=n("Reading the code, i got to the "),$=F("code"),ls=n("flag"),os=n(" point. In the "),H=F("code"),ns=n("index.php"),ts=n(" file, we have:"),V=f(),x=new xs(!1),S=f(),A=F("p"),ps=n("So, in order to get the flag, we need to create a gold tier user first. The PHP application itself doesn’t offer any signup functionlaity but the "),W=F("code"),Fs=n("account_migrator.php"),rs=n(" file does that is being called from the flask application. So, if we look at the flask application, we will find where the user is being registered."),N=f(),w=F("p"),cs=n("In the "),q=F("code"),is=n("authorized_routes.py"),Ds=n(", we have:"),j=f(),I=new xs(!1),L=f(),E=F("p"),ys=n("The validation is based on the statement: "),z=F("code"),ds=n("request.form.get('tier')"),Es=n(". This will always pick the first parameter if multiple parameters are to be supplied However, the application is passing the "),G=F("code"),us=n("raw_request"),fs=n(" as it is to the next application which is in PHP. In order words"),this.h()},l(s){o=r(s,"H1",{id:!0});var p=c(o);D=r(p,"A",{href:!0});var vs=c(D);u=t(vs,"Introduction"),vs.forEach(e),p.forEach(e),v=h(s),l=r(s,"P",{});var T=c(l);y=t(T,"This writeup is for the under construction challenge from web category in Google CTF 2023. The challenge was provided with the following statement: "),m=r(T,"EM",{});var ms=c(m);X=t(ms,"“We were building a web app but the new CEO wants it remade in php.”"),ms.forEach(e),J=t(T," The challenge contained 2 different web apps. One was in PHP that seems to be under development whilst flask app seemed like a full application. This writeup covers an "),O=r(T,"CODE",{});var As=c(O);Q=t(As,"Parameter Pollution"),As.forEach(e),Y=t(T," vulnerability we were able to create an escalated user by supplying more than 1 parameter."),T.forEach(e),U=h(s),_=r(s,"H1",{id:!0});var ws=c(_);b=r(ws,"A",{href:!0});var _s=c(b);ss=t(_s,"Writeup"),_s.forEach(e),ws.forEach(e),R=h(s),C=r(s,"P",{});var gs=c(C);es=t(gs,"So, at first i visited the URLS and got to know the application surface. Then i downloaded the challenge files available and opened them in the editor."),gs.forEach(e),Z=h(s),d=r(s,"P",{});var P=c(d);as=t(P,"Reading the code, i got to the "),$=r(P,"CODE",{});var bs=c($);ls=t(bs,"flag"),bs.forEach(e),os=t(P," point. In the "),H=r(P,"CODE",{});var Cs=c(H);ns=t(Cs,"index.php"),Cs.forEach(e),ts=t(P," file, we have:"),P.forEach(e),V=h(s),x=Ss(s,!1),S=h(s),A=r(s,"P",{});var B=c(A);ps=t(B,"So, in order to get the flag, we need to create a gold tier user first. The PHP application itself doesn’t offer any signup functionlaity but the "),W=r(B,"CODE",{});var Ts=c(W);Fs=t(Ts,"account_migrator.php"),Ts.forEach(e),rs=t(B," file does that is being called from the flask application. So, if we look at the flask application, we will find where the user is being registered."),B.forEach(e),N=h(s),w=r(s,"P",{});var K=c(w);cs=t(K,"In the "),q=r(K,"CODE",{});var Ps=c(q);is=t(Ps,"authorized_routes.py"),Ps.forEach(e),Ds=t(K,", we have:"),K.forEach(e),j=h(s),I=Ss(s,!1),L=h(s),E=r(s,"P",{});var k=c(E);ys=t(k,"The validation is based on the statement: "),z=r(k,"CODE",{});var ks=c(z);ds=t(ks,"request.form.get('tier')"),ks.forEach(e),Es=t(k,". This will always pick the first parameter if multiple parameters are to be supplied However, the application is passing the "),G=r(k,"CODE",{});var Os=c(G);us=t(Os,"raw_request"),Os.forEach(e),fs=t(k," as it is to the next application which is in PHP. In order words"),k.forEach(e),this.h()},h(){M(D,"href","#introduction"),M(o,"id","introduction"),M(b,"href","#writeup"),M(_,"id","writeup"),x.a=S,I.a=L},m(s,p){i(s,o,p),a(o,D),a(D,u),i(s,v,p),i(s,l,p),a(l,y),a(l,m),a(m,X),a(l,J),a(l,O),a(O,Q),a(l,Y),i(s,U,p),i(s,_,p),a(_,b),a(b,ss),i(s,R,p),i(s,C,p),a(C,es),i(s,Z,p),i(s,d,p),a(d,as),a(d,$),a($,ls),a(d,os),a(d,H),a(H,ns),a(d,ts),i(s,V,p),x.m(qs,s,p),i(s,S,p),i(s,A,p),a(A,ps),a(A,W),a(W,Fs),a(A,rs),i(s,N,p),i(s,w,p),a(w,cs),a(w,q),a(q,is),a(w,Ds),i(s,j,p),I.m(Is,s,p),i(s,L,p),i(s,E,p),a(E,ys),a(E,z),a(z,ds),a(E,Es),a(E,G),a(G,us),a(E,fs)},p:Ks,d(s){s&&e(o),s&&e(v),s&&e(l),s&&e(U),s&&e(_),s&&e(R),s&&e(C),s&&e(Z),s&&e(d),s&&e(V),s&&x.d(),s&&e(S),s&&e(A),s&&e(N),s&&e(w),s&&e(j),s&&I.d(),s&&e(L),s&&e(E)}}}function Js(g){let o,D;const u=[g[0],Ws];let v={$$slots:{default:[Xs]},$$scope:{ctx:g}};for(let l=0;l<u.length;l+=1)v=hs(v,u[l]);return o=new Ms({props:v}),{c(){Us(o.$$.fragment)},l(l){Rs(o.$$.fragment,l)},m(l,y){Zs(o,l,y),D=!0},p(l,[y]){const m=y&1?Vs(u,[y&1&&$s(l[0]),y&0&&$s(Ws)]):{};y&2&&(m.$$scope={dirty:y,ctx:l}),o.$set(m)},i(l){D||(Ns(o.$$.fragment,l),D=!0)},o(l){js(o.$$.fragment,l),D=!1},d(l){Bs(o,l)}}}const Ws={title:"Google CTF 2023 Under Construction (Web) Writeup",tags:["ctf","writeups","google-ctf-2023"],categories:["CTF Writeups"],summary:"Writeup for under construction challenge from google ctf 2023",created:"2023-06-27T00:00:00.000Z",lastmod:"2023-06-27T00:00:00.000Z",image:"https://github.com/hash3liZer/khatta.sh/assets/29171692/f553635d-6deb-43e5-a2ae-0d8cef296db7",flags:[],updated:"2023-06-27T13:52:44.807Z",slug:"/blog/2023/writeup-under-construction-google-ctf-2024/+page.md",path:"/blog/2023/writeup-under-construction-google-ctf-2024",toc:[{depth:1,title:"Introduction",slug:"introduction"},{depth:1,title:"Writeup",slug:"writeup"}]};function Qs(g,o,D){return g.$$set=u=>{D(0,o=hs(hs({},o),Hs(u)))},o=Hs(o),[o]}class ee extends Ls{constructor(o){super(),zs(this,o,Qs,Js,Gs,{})}}export{ee as component};
